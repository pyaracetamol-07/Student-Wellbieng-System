<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Student Wellbeing Report</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 950px;
      margin: auto;
      padding: 30px;
    }

    .card {
      background: white;
      border-radius: 22px;
      padding: 35px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.25);
    }

    h1 {
      text-align: center;
      font-size: 38px;
      color: #1e3a8a;
    }

    .subtitle {
      text-align: center;
      font-size: 17px;
      color: #555;
      margin-bottom: 30px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-top: 18px;
    }

    .scale-desc {
      font-size: 13px;
      color: #374151;
      margin: 4px 0 6px 0;
    }

    input, select {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    button {
      width: 100%;
      padding: 16px;
      margin-top: 22px;
      border: none;
      border-radius: 14px;
      font-size: 17px;
      font-weight: bold;
      color: white;
      background: linear-gradient(135deg, #6366f1, #3b82f6);
      cursor: pointer;
    }

    video {
      width: 100%;
      border-radius: 16px;
      margin-top: 20px;
      border: 2px solid #ddd;
    }

    .report {
      margin-top: 35px;
      padding: 45px;
      border-radius: 22px;
      text-align: center;
      color: white;
      font-size: 22px;
    }

    .report h2 {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .percentage {
      font-size: 52px;
      font-weight: bold;
      margin: 15px 0;
    }

    canvas {
      margin-top: 40px;
    }

    .helpline {
      display: none;
      margin-top: 30px;
      padding: 30px;
      border-radius: 18px;
      background: #fee2e2;
      color: #7f1d1d;
      font-size: 18px;
    }
  </style>
</head>

<body>
<div class="container">
  <div class="card">

    <h1>ğŸ§  Student Wellbeing Assessment</h1>
    <div class="subtitle">
      A private self-check to understand your stress and emotional wellbeing
    </div>

    <label>Student ID</label>
    <input id="studentId" placeholder="Enter your Student ID">

    <label>Do you consent to share this data for wellbeing support?</label>
    <select id="consent">
      <option value="">-- Select --</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>

    <p><b>Rate from 0 (Lowest) to 5 (Highest)</b></p>

    <label>How often have you felt sad or low in the past week?</label>
    <div class="scale-desc">0 â€“ not at all | 1 â€“ rarely | 2 â€“ sometimes | 3 â€“ often | 4 â€“ very often | 5 â€“ almost always</div>
    <select id="sadLow">
      <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
    </select>

    <label>How stressed do you feel academically right now?</label>
    <div class="scale-desc">0 â€“ no stress | 1 â€“ very low | 2 â€“ manageable | 3 â€“ high | 4 â€“ very high | 5 â€“ overwhelming</div>
    <select id="academicStress">
      <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
    </select>

    <!-- NEW Satisfaction Question as 4th -->
    <label>On a scale of 0 to 5, how much are you satisfied with your current marks?</label>
    <div class="scale-desc">0 â€“ very satisfied | 1 â€“ satisfied | 2 â€“ somewhat satisfied | 3 â€“ neutral | 4 â€“ dissatisfied | 5 â€“ very dissatisfied</div>
    <select id="satisfaction">
      <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
    </select>

    <label>How often do you feel lonely or isolated?</label>
    <div class="scale-desc">0 â€“ never | 1 â€“ rarely | 2 â€“ sometimes | 3 â€“ often | 4 â€“ very often | 5 â€“ always</div>
    <select id="lonely">
      <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
    </select>

    <label>How often do you feel emotionally exhausted at the end of the day?</label>
    <div class="scale-desc">0 â€“ not at all | 1 â€“ slightly | 2 â€“ sometimes | 3 â€“ often | 4 â€“ very often | 5 â€“ completely drained</div>
    <select id="exhausted">
      <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
    </select>

    <label>How hopeful do you feel about the near future?</label>
    <div class="scale-desc">0 â€“ no hope | 1 â€“ very low | 2 â€“ unsure | 3 â€“ somewhat hopeful | 4 â€“ hopeful | 5 â€“ very hopeful</div>
    <select id="hopeful">
      <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
    </select>

    <label>How well have you been sleeping in the past week?</label>
    <div class="scale-desc">0 â€“ not at all | 1 â€“ very poorly | 2 â€“ poorly | 3 â€“ okay | 4 â€“ well | 5 â€“ very well</div>
    <select id="sleep">
      <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
    </select>

    <video id="video" autoplay></video>

    <button onclick="startCamera()">ğŸ“¸ Open Camera & Capture Mood</button>
    <button onclick="submitData()">ğŸ“Š Generate My Full Wellbeing Report</button>

    <div id="finalReport"></div>

    <div id="helplineBox" class="helpline">
      <h2>ğŸš¨ You Are Not Alone</h2>
      <p>If you are feeling overwhelmed or unsafe, please seek immediate help:</p>
      <ul>
        <li><b>KIRAN (India):</b> 1800-599-0019</li>
        <li><b>AASRA:</b> +91-9820466726</li>
        <li><b>SNEHA:</b> 044-24640050</li>
      </ul>
    </div>

    <canvas id="chart"></canvas>

  </div>
</div>

<script>
let mood = 3;

function startCamera() {
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
      alert("Camera active. Capturing moodâ€¦");

      setTimeout(() => {
        mood = Math.floor(Math.random() * 5) + 1;
        stream.getTracks().forEach(t => t.stop());
        alert("Mood captured successfully.");
      }, 1800);
    })
    .catch(() => alert("Camera permission denied."));
}

function submitData() {
  if (!studentId.value) {
    alert("Please enter Student ID.");
    return;
  }
  if (consent.value !== "Yes") {
    alert("Consent is required.");
    return;
  }

  const data = {
    studentId: studentId.value,
    consent: consent.value,
    sadLow: sadLow.value,
    academicStress: academicStress.value,
    satisfaction: satisfaction.value,  // NEW
    lonely: lonely.value,
    exhausted: exhausted.value,
    hopeful: hopeful.value,
    sleep: sleep.value,
    mood: mood
  };

  google.script.run.withSuccessHandler(res => {
    let bg = "#22c55e", emoji = "ğŸ˜Š";
    helplineBox.style.display = "none";

    if (res.riskLevel === "Moderate") {
      bg = "#f59e0b";
      emoji = "ğŸ˜";
    }

    if (res.riskLevel === "High") {
      bg = "#dc2626";
      emoji = "ğŸ˜Ÿ";
      helplineBox.style.display = "block";
    }

    finalReport.innerHTML = `
      <div class="report" style="background:${bg}">
        <h2>${emoji} ${res.riskLevel} Stress</h2>
        <div class="percentage">${res.riskPercentage}%</div>
        <p>${res.message}</p>
      </div>
    `;

    const colors = ['#6366f1','#f472b6','#facc15','#34d399','#f97316','#60a5fa','#a78bfa'];
    new Chart(chart, {
      type: 'bar',
      data: {
        labels: Object.keys(res.responses),
        datasets: [{
          data: Object.values(res.responses),
          backgroundColor: colors
        }]
      },
      options: {
        scales: { y: { min: 0, max: 5 } },
        plugins: { legend: { display: false } }
      }
    });
  }).saveData(data);
}
</script>
</body>
</html>